{% extends 'base.html' %}

{% load static %}

{% block head %}  

<!-- Icons -->
<script src="https://unpkg.com/feather-icons"></script>

<!-- Custom CSS -->
<link rel="stylesheet" href="/static/css/quotation/createnew.css">

<style>
    div.card {
        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.2);
        text-align: center;
    }
</style>
{% endblock head %}


{% block content %}

<div class="container mt-3" >
    <form  method="POST">
        {% csrf_token %}
        <!-- bagian paling atas yang tidak bisa ke scroll -->
        <div class="row">
            <div class="col-sm-2 text-center">
                        <div class="row">
                            <div class="col mt-2 mb-2">
                                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModalCust" >Customer</button>
                            </div>
                            <div class="col mt-3 mb-2">
                                <a href="#" class="">
                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModalCust1">Products</button>
                                </a>
                            </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <div class="card-body">

                        <div class="row mb-2">
                            <div class="col">
                                <div>
                                    Quantity
                                </div>
                                <div>
                                    <input class="" type="text" id="quantity" onchange="calculateTotalBudget()">
                                </div>
                            </div>
                    
                            <div class="col-sm-1">
                                <div class="text-center">
                                    x
                                </div>
                            </div>
                            
                            <div class="col">
                                <div>
                                    Budget/Unit
                                </div>
                                <div>
                                    <input class="" type="text" id="budgetPerUnit" onchange="calculateTotalBudget()">
                                </div>
                            </div>
                    
                            
                            <div class="col-sm-1">
                                <div class="text-center">
                                    =
                                </div>
                            </div>
                            
                            <div class="col">
                                <div>
                                    Total Budget
                                </div>
                                <div>
                                    <input class="noInput " type="text" value="0" id="totalBudget">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                Cost Exclude Operation
                                <input type="text" value="0" class="noInput " id="costExcludeOperation">
                            </div>
                    
                            <div class="col-sm-1">
                                <div class="text-center">
                                    x
                                </div>
                            </div>
                            
                            <div class="col">
                                Operation Cost
                                <input type="text" class="noInput " value="0" id="operationCost">
                            </div>
                    
                            
                            <div class="col-sm-1">
                                <div class="text-center">
                                    =
                                </div>
                            </div>
                            
                            <div class="col">
                                <div>
                                    Total Cost
                                </div>
                                <div>
                                    <input type="text" value="0" class="noInput " id="totalCost">
                                </div>
                            </div>
                        </div>

                        

                    </div>
                </div>
            </div>
        </div>

        <hr>

        <div style="overflow: auto; max-height: 75vh;" class="">
            <!-- bagian body tengah -->
            <div class="row">
                <!-- perkaliannya -->
                <div class="col-7">
                    <div class="col mb-2">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <div>
                                            Budget/Unit
                                        </div>
                                        <div>
                                            <input type="text" class="inputMd noInput " id="budgetPerUnit2" value="0">
                                        </div>
                                    </div>

                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div>
                                            Percentage
                                        </div>
                                        <div>
                                            <input type="text" class="inputPercentage " id="managementCostPercentage" value="30" onchange="calculateManagementCost()"> %
                                        </div>
                                        
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Management Cost
                                        <input type="text" value="0" class="inputMd noInput " id="managementCost">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col mb-2">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <a type="button" data-bs-toggle="modal" data-bs-target="#exampleModal" >
                                            Material Cost
                                        </a>
                                        <input type="text" class="inputMd " id="materialCost" onchange="calculateTotalMaterialCost()">
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div>
                                            Percentage
                                        </div>
                                        <div>
                                            <input type="text" value="100" class="inputPercentage " id="materialCostPercentage" onchange="calculateTotalMaterialCost()"> %
                                        </div>
                                        
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div>
                                            Total Material Cost
                                        </div>
                                        <div>
                                            <input type="text" value="0"  class="inputMd noInput " id="totalMaterialCost">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="card">
                            <div class="card-body">

                                <div class="row mb-2">
                                    <div class="col">
                                        Outsource Cost
                                        <input class="inputMd " type="text" name="outsourceCost" id="outsourceCost" onchange="calculateTotalOursourceCost()">
                                        <!-- <input type="text" id="quantity"> -->
                                    </div>
                            
                                    <div class="col-sm-1">
                                        x
                                    </div>
                                    
                                    <div class="col">
                                        <div>
                                            Percentage
                                        </div>
                                        <div>
                                            <input class="inputPercentage " type="text" value="100" id="outsourceCostPercentage" onchange="calculateTotalOursourceCost()"> %
                                        </div>
                                        
                                    </div>
                            
                                    
                                    <div class="col-sm-1">
                                        =
                                    </div>
                                    
                                    <div class="col">
                                        <div>
                                            Total Outsource Cost
                                        </div>
                                        <div>
                                            <input class="inputMd noInput " value="0" type="text" id="totalOutsourceCost">
                                        </div>
                                        
                                    </div>
                                </div>

                                

                            </div>
                        </div>
                    </div>
                </div>

                
                <!-- bagian kanannya yang ada radio -->
                <div class="col-5">
                    <div class="card">
                        <div class="card-body">
                            <div style="display: flex; flex-basis: 40%; justify-content: right;">
                                <input type="input" list="others" id="otherName" placeholder="Search ..." class="inputSearch ">
                                <datalist id="others">
                                    {% for other in others %}
                                        <option value="{{other.Name}}">
                                    {% endfor %}
                                </datalist>
                                <button type="button" onclick="addOther()" class="btn btn-secondary btnsearch">Add</button>
                            </div>
                            <input type="hidden" id="othersLength" name="othersLength" class="">
                            <table class="table table-hover" id="othersTable" style="text-align: center;">
                                <thead>
                                <tr>
                                    <th scope="col">No</th>
                                    <th scope="col">Others</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">%</th>
                                    <th scope="col">/Unit</th>
                                    <th scope="col">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <hr>
            <div class="card" style="max-width: 80vw;">
                <div class="card-body">
                    <!-- tabel, search, button create -->
                    <div style="display: flex; align-items: center;">
                        <div class="text-center" style=" align-items:center; display: flex; width: 100%;">
                            Operation Budget
                            <input style="margin-left: 3%;" type="text" value="0" class="inputMd noInput " id="operationBudget">
                        </div>
                        <div style="display: flex; justify-content: right; width: 100%;">
                            <input type="input" list="process" id="processName" placeholder="Search ..." class="inputSearch " >
                            <datalist id="process">
                                {% for p in process %}
                                    <option value="{{p.Name}}" />
                                {% endfor %}
                            </datalist>
                            <button type="button" onclick="addProcess()" class="btn btn-secondary btnsearch">Add</button>
                        </div>
                    </div>

                    <input type="hidden" id="processLength" name="processLength" class="">
                    <table class="table table-hover" id="processTable" style="text-align: center;">
                        <thead style="vertical-align: middle;">
                        <tr>
                            <th scope="col">No</th>
                            <th scope="col">Id</th>
                            <th scope="col">Proc</th>
                            <th scope="col">Set / Proc cost@min</th>
                            <th scope="col">OpeSum</th>
                            <th scope="col">Ope / Ope Budget Ratio</th>
                            <th scope="col">Ope / Budget Ratio</th>
                            <th scope="col">SetTime</th>
                            <th scope="col">OpeTime</th>
                            <th scope="col">Total OpeTime</th>
                            <th scope="col">Quantity @min</th>
                            <th scope="col">#</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3"></th>
                                <td>Total</td>
                            </tr>
                            <tr>
                                <th colspan="3"></th>
                                <td>Rest</td>
                            </tr>
                        </tfoot>
                    </table>

                </div>
            </div>
            
            <div class="btncreate">
                <a href="{% url 'PDFQuotation' %}"><button type="button" class="btn btn-secondary">Create</button></a>
            </div> 
        </div>


    <!-- modal quotation material -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-body">  
                <div style="display: flex; flex-basis: 40%; justify-content: right;">
                    <input type="input" list="material" id="searchName" name="searchName" placeholder="Search ..." class="inputSearch " >
                        <datalist id="material">
                            {% for m in material %}
                                <option value="{{m.Name}}" />
                            {% endfor %}
                        </datalist>
                    <button type="button" class="btn btn-secondary btnsearch">Add</button>
                </div>

                <input type="hidden" id="materialLength" name="materialLength">
                <table class="table table-hover" id="materialTable">
                    <thead>
                      <tr>
                        <th scope="col">No</th>
                        <th scope="col">Material Code</th>
                        <th scope="col">Material Name</th>
                        <th scope="col">Used Process</th>
                        <th scope="col">Used Quantity</th>
                        <th scope="col">Number</th>
                        <th scope="col">Price</th>
                        <!-- <th scope="col">TempPrice</th> -->
                        <th scope="col">Material Cost</th>
                        <th scope="col">#</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
            
                  
                  <button type="button" class="btn btn-secondary btnsearch2" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-secondary btnsearch2">Reflect Cost</button>
            </div>
          </div>
        </div>
    </div>

    <!-- modal products -->
    <div class="modal" tabindex="-1" id="exampleModalCust1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header" style="justify-content: center;">
              <h5 class="modal-title">PRODUCTS</h5>
              <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
            </div>

            <div class="modal-body" style="margin: 0 10%;">
                
                <div class="row" style="margin: 2% 0 5%;">
                    <div class="col">
                        <label>
                          ID
                        </label>
                        <input value='{{productid}}' name="productid" id="productid" required>
                    </div>
                    <div class="col">
                        <label>
                          Name
                        </label>
                        <input value='{{productname}}' name="productname" id="productname" required>
                    </div>
                    <div class="col">
                      <label>
                        Vers
                      </label>
                      <input value='{{productver}}' name="productver" id="productver">
                    </div>
                </div>

                <div >
                        <table id="ProductsTable" class="display">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in product %}
                                <tr>
                                    <th scope="row"><button onclick="getProduct(this.value)" value="{{p.idProduct}}_{{p.productName}}" style="border: none; background-color:transparent; width:25px; text-align: center;" type="button">{{p.idProduct}}</button></th>
                                    <td > <button onclick="getProduct(this.value)" value="{{p.idProduct}}_{{p.productName}}" style="border: none; background-color:transparent; width: 100%; height: auto; text-align: left;" type="button">{{p.productName}}</button ></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnsearch2">Submit</button>
                <button type="button" class="btn btn-secondary btnsearch2" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    <!-- modal customer -->
    <div class="modal" tabindex="-1" id="exampleModalCust">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header" style="justify-content: center;">
              <h5 class="modal-title">CUSTOMER</h5>
              <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
            </div>
            <div class="modal-body" style="margin: 0 10%;">
                <div class="row customer" style="margin: 2% 0 5%;">
                    <div class="col">
                        <label>
                          ID
                        </label>
                        <input value='{{customerid}}' name="customerid" id="customerid" required>
                    </div>
                    <div class="col">
                        <label>
                          Name
                        </label>
                        <input value='{{customername}}' name="customername" id="customername" required>
                    </div>
                    <div class="col">
                      <label>
                        Attn
                      </label>
                      <input value='{{customerto}}' name="customerto" id="customerto">
                    </div>
                </div>

                <div>
                    <table id="CustomersTable" class="display">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for customer in customer %}
                            <tr>
                                <th scope="row"><button onclick="getCustomer(this.value)" value="{{customer.idCustomer}}_{{customer.customerName}}" style="border: none; background-color:transparent; width:25px; text-align: center;" type="button">{{customer.idCustomer}}</button></th>
                                <td > <button onclick="getCustomer(this.value)" value="{{customer.idCustomer}}_{{customer.customerName}}" style="border: none; background-color:transparent; width: 100%; height: auto; text-align: left;" type="button">{{customer.customerName}}</button ></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnsearch2">Submit</button>
                <button type="button" class="btn btn-secondary btnsearch2" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal calculator option -->
      <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header"  style="justify-content: center;">
                <h5 class="modal-title" id="exampleModalToggleLabel">Select Material</h5>
                <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
            </div>
            <div class="modal-body">
                  <button type="button" class="btn btn-secondary btnsearch1" data-bs-toggle="modal" data-bs-target="#exampleModal2">Board</button>
                  <button type="button" class="btn btn-secondary btnsearch1" data-bs-toggle="modal" data-bs-target="#exampleModal3">Bar</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnsearch2" data-bs-toggle="modal" data-bs-target="#exampleModal">Back</button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal board -->
      <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>MATERIAL</h6>
                            <div class="row">
                                    <div class="col">
                                        Material ID
                                        <input class="inputtt noInput" type="text" value="" id="BoardMaterialId">
                                    </div>
                                    <div class="col">
                                        Material Name
                                        <input class="inputtt" type="text" list="part" value="" id="BoardMaterialName" onchange="getPart(this.value)">
                                        <datalist id="part">
                                            {% for p in part %}
                                                <option value="{{p.name}}"/>
                                            {% endfor %}
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- outline scale -->
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>OUTLINE SCALE</h6>
                            </div>
                            <div class="row cardmodal">
                                <div class="col">
                                    Part Scale
                                    <input class="inputtt1 " type="text"> mm
                                </div>
                                <div class="col">
                                    Horizontal Scale
                                    <input class="inputtt1 " type="text"> mm
                                </div>
                                <div class="col">
                                    Thickness
                                    <input class="inputtt1 " type="text"> mm
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- material cost -->
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>MATERIAL COST</h6>
                                <div class="row">
                                    <div class="col">
                                        Spesific Gravity
                                        <input class="inputtt " type="text">
                                    </div>
                                    <div class="col">
                                        Price / KG
                                        <input class="inputtt " type="text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- from number of & from part scale-->
                <div class="row jarak">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>FROM NUMBER OF</h6>
                                <!-- baris 1 -->
                                <div class="row">
                                    <div class="col">
                                        Vertical Scale
                                        <input class="inputtt2 " type="text"> mm
                                    </div>
                                    <div class="col">
                                        Horizontal Scale
                                        <input class="inputtt2 " type="text"> mm
                                    </div>
                                </div>
                                <!-- baris 2 -->
                                <div class="row">
                                    <div class="col">
                                        Exposed
                                        <input class="inputtt2 input" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Margin
                                        <input class="inputtt2" type="text"> mm
                                    </div>
                                </div>

                                <!-- baris 3 -->
                                <div class="row jarak">
                                    <div class="col">
                                        Vertical Number
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Horizontal Number
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Quantity per Sheet
                                        <input class="inputtt3" type="text">
                                    </div>
                                </div>

                                <!-- baris 4 -->
                                <div class="row jarak">
                                    <div class="col">
                                        Weight (KG)
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Quantity
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Weight / Quantity
                                        <input class="inputtt3" type="text">
                                    </div>
                                </div>

                                <!-- baris 5 -->
                                <div class="row jarak">
                                    <div class="col">
                                        Price / KG
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Weight
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        Material Cost
                                        <input class="inputtt3" type="text">
                                    </div>
                                </div>

                                <!-- material cost -->
                                <div class="jarak" style="margin-left: 35%;">
                                    <div class="row">
                                        <div class="col">
                                            <h5>MATERIAL COST</h5>
                                        </div>
                                        <div class="col">
                                            <h5>40000</h5>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" class="btn btn-secondary btnsearch2">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- from part scale -->
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>FROM PART SCALE</h6>
                                <!-- baris 1 -->
                                <div class="row">
                                    <div class="col">
                                        Exposed
                                        <input class="inputtt2" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Margin
                                        <input class="inputtt2" type="text"> mm
                                    </div>
                                </div>

                                <!-- baris 2 -->
                                <div class="row">
                                    <div class="col">
                                        Weight
                                        <input class="inputtt2" type="text" style="margin-left: -8px;"> kg
                                    </div>
                                    <div class="col">
                                    </div>
                                </div>

                                <!-- baris 3 -->
                                <div class="row jarak">
                                    <div class="col">
                                        Price / KG
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            x
                                        </div>
                                    </div>
                                    <!-- <div>
                                        asd
                                    </div> -->
                                    
                                    <div class="col">
                                        Weight
                                        <input class="inputtt3" type="text">
                                    </div>
                            
                                    
                                    <div class="col-sm-1">
                                        <div class="text-center">
                                            =
                                        </div>
                                    </div>

                                    <div class="col">
                                        Material Cost
                                        <input class="inputtt3" type="text">
                                    </div>
                                </div>

                                <!-- material cost -->
                                <div class="jarak" style="margin-left: 35%; margin-top: 23.5%;">
                                    <div class="row">
                                        <div class="col">
                                            <h5>MATERIAL COST</h5>
                                        </div>
                                        <div class="col">
                                            <h5>40000</h5>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" class="btn btn-secondary btnsearch2">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- board (margin number of preview)-->
                    <div class="row jarak">
                        <div class="col">
                            <h6>
                                MARGIN (NUMBER OF)
                            </h6>
                            <div class="txtimg">
                                <img src="{% static 'images/boardmarginnumberof.png' %}">
                                <div class="angka">50</div>
                                <div class="angka1">70</div>
                                <div class="angka2">80</div>
                                <div class="angka3">90</div>
                                <div class="angka4">0</div>
                            </div>
                        </div>
                        <div class="col">
                            <h6>
                                MARGIN (SCALE)
                            </h6>
                            <div class="txtimg">
                                <img src="{% static 'images/boardmarginscale.png' %}">
                                <div class="angka5">50</div>
                                <div class="angka6">0</div>
                            </div>
                        </div>
                        
                    </div>

                    <div>
                        <button type="button" class="btn btn-secondary btnsearch2" data-bs-toggle="modal" data-bs-target="#exampleModal1">Back</button>
                    </div>

                </div>


            </div>
          </div>
        </div>
      </div>

      <!-- modal bar -->
      <div class="modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>MATERIAL</h6>
                            <div class="row">
                                    <div class="col">
                                        Material ID
                                        <input class="inputtt" type="text">
                                    </div>
                                    <div class="col">
                                        Material Name
                                        <input class="inputtt" type="text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>OUTLINE SCALE</h6>
                                <div class="row">
                                    <div class="col">
                                        Part Scale
                                        <input class="inputtt4" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Diameter
                                        <input class="inputtt4" type="text"> mm
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>MATERIAL COST</h6>
                                <div class="row">
                                    <div class="col">
                                        Spesific Gravity
                                        <input class="inputtt" type="text">
                                    </div>
                                    <div class="col">
                                        Price / KG
                                        <input class="inputtt" type="text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- calculation number of quantity -->
                <div class="row jarak1">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>CALCULATION NUMBER OF QUANTITY</h6>
                                <!-- baris 1 -->
                                <div class="row">
                                    <div class="col">
                                        Exposed
                                        <input class="kolominput1" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Diameter
                                        <input class="kolominput1" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Edge Loss
                                        <input class="kolominput1" type="text"> mm
                                    </div>
                                </div>

                                <hr>

                                <!-- baris 3 -->
                                <div class="row">
                                    <div class="col">
                                        Material Cost
                                        <input class="kolominput" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Number
                                        <input class="kolominput" type="text"> mm
                                    </div>
                                </div>

                                <!-- baris 4 -->
                                <div class="row">
                                    <div class="col">
                                        Scala
                                        <input class="kolominput" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Used Quantity
                                        <input class="kolominput" type="text"> kg
                                    </div>
                                </div>



                                <!-- material cost -->
                                <div class="jarak" style="margin-left: 35%;">
                                    <div class="row">
                                        <div class="col">
                                            <h5>MATERIAL COST</h5>
                                        </div>
                                        <div class="col">
                                            <h5>40000</h5>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" class="btn btn-secondary btnsearch2" >Submit</button>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- calculation from scale -->
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <h6>CALCULATION FROM SCALE</h6>
                                <!-- baris 1 -->
                                <div class="row">
                                    <div class="col">
                                        Keft Loss
                                        <input class="inputtt2" type="text"> mm
                                    </div>
                                    <div class="col">
                                        Used Quantity
                                        <input class="inputtt2" type="text"> mm
                                    </div>
                                </div>

                                <!-- material cost -->
                                <div class="jarak" style="margin-left: 35%; margin-top: 25.5%;">
                                    <div class="row">
                                        <div class="col">
                                            <h5>MATERIAL COST</h5>
                                        </div>
                                        <div class="col">
                                            <h5>40000</h5>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" class="btn btn-secondary btnsearch2">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row jarak2">
                        <div class="col">
                            <div class="txtimg">
                                <img class="imgwidth" src="{% static 'images/barmarginnumberof.png' %}">
                                <div class="judul">Exposed</div>
                                <div class="judul1">Scala</div>
                                <div class="judul2">Edge Loss</div>
                                <div class="angkaa">0.00</div>
                                <div class="angkaa1">0.00</div>
                                <div class="angkaa2">0.00</div>
                                <div class="horizontalline"><hr></div>
                                <div>0.00</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="txtimg">
                                <img class="imgwidth1"src="{% static 'images/barmarginscale.png' %}">
                                <div class="angkaa3">0.00</div>
                                <div class="angkaa4">0.00</div>
                                <div class="angkaa5">0.00</div>
                                <div >0.00</div>
                                
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <button type="button" class="btn btn-secondary btnsearch2" data-bs-toggle="modal" data-bs-target="#exampleModal1">Back</button>
                </div>


            </div>
          </div>
        </div>
      </div>

    </div>

    </div>
</form>
{% endblock content %}


{% block scripts %}
<!-- modal board -->
<script>
    function getPart(){
        var partName = document.getElementById('BoardMaterialName').value;

        var part = '{{partjs|safe}}';
        const obj = JSON.parse(part);
        var selectedPart = obj.find(element => element.name == partName);

        $('#BoardMaterialId').val(selectedPart.idPart);
        // $('#MaterialSpesificGravity').val(selectedpart.SpesificGravity);
        // $('#MaterialPrice').val(selectedpart.Price);
    }
</script>

<!-- datatable & customer function -->
<script>
    $(document).ready(function () {
        $('#CustomersTable').DataTable({
            "paging": true,
            "searching": true,
            "autoWidth": true,
            "ordering": true,
        });
    });

    function getCustomer(value) {
        var elements = value.split('_');
        var id = elements[0];
        var name = elements[1];

        $('#customerid').val(id);
        $('#customername').val(name);
    }
</script>

<!-- datatable & product function -->
<script>
    $(document).ready(function () {
        $('#ProductsTable').DataTable({
            "paging": true,
            "searching": true,
            "autoWidth": true,
            "ordering": true,
        });
    });

    function getProduct(value) {
        var elements = value.split('_');
        var id = elements[0];
        var name = elements[1];

        $('#productid').val(id);
        $('#productname').val(name);
    }
</script>

<!-- on load function -->
<script>
  $(document).ready(function () {
    $('#myTable').DataTable({
    });
  });
</script>

<!-- nonInputabel input  -->
<script>
    $("#totalBudget").focus(function(){
        $(this).blur(); 
    });
    $("#operationCost").focus(function(){
        $(this).blur(); 
    });
    $("#totalCost").focus(function(){
        $(this).blur(); 
    });
    $("#costExcludeOperation").focus(function(){
        $(this).blur(); 
    });
    $("#managementCost").focus(function(){
        $(this).blur(); 
    });
    $("#totalMaterialCost").focus(function(){
        $(this).blur(); 
    });
    $("#managementCost").focus(function(){
        $(this).blur(); 
    });
    $("#totalOutsourceCost").focus(function(){
        $(this).blur(); 
    });
    $("#operationBudget").focus(function(){
        $(this).blur(); 
    });
    $("#budgetPerUnit2").focus(function(){
        $(this).blur(); 
    });
    budgetPerUnit2
</script>

<!-- calculation functions -->
<script>
    // buat others 
    var othersIndex = 0;
    const othersList = [];

    // buat process 
    var index = 0;
    const processList = [];

    // buat material 
    var materialIndex = 0;
    const materialList = [];

    function getData(){
        var data = {
            'quantity' : isNaN(parseFloat(document.getElementById('quantity').value)) ? 0 : parseFloat(document.getElementById('quantity').value),
            'budgetPerUnit' : isNaN(parseFloat(document.getElementById('budgetPerUnit').value)) ? 0 : parseFloat(document.getElementById('budgetPerUnit').value),
            'totalBudget' : isNaN(parseFloat(document.getElementById('totalBudget').value)) ? 0 : parseFloat(document.getElementById('totalBudget').value),
            'managementCostPercentage' : isNaN(parseFloat(document.getElementById('managementCostPercentage').value)) ? 0 : parseFloat(document.getElementById('managementCostPercentage').value),
            'managementCost' : Number(document.getElementById('managementCost').value.replace(/[^0-9.-]+/g,"")),

            'materialCost' : isNaN(parseFloat(document.getElementById('materialCost').value)) ? 0 : parseFloat(document.getElementById('materialCost').value),
            'materialCostPercentage' : isNaN(parseFloat(document.getElementById('materialCostPercentage').value)) ? 0 : parseFloat(document.getElementById('materialCostPercentage').value),
            'totalMaterialCost' : Number(document.getElementById('totalMaterialCost').value.replace(/[^0-9.-]+/g,"")),

            'outsourceCost' : isNaN(parseFloat(document.getElementById('outsourceCost').value)) ? 0 : parseFloat(document.getElementById('outsourceCost').value),
            'outsourceCostPercentage' : isNaN(parseFloat(document.getElementById('outsourceCostPercentage').value)) ? 0 : parseFloat(document.getElementById('outsourceCostPercentage').value),
            'totalOutsourceCost' : Number(document.getElementById('totalOutsourceCost').value.replace(/[^0-9.-]+/g,"")),

            'operationBudget' : Number(document.getElementById('operationBudget').value.replace(/[^0-9.-]+/g,"")),
        }   

        return data;
    }

    function zeroSeparator(val){
        val = parseFloat(val).toLocaleString('en');
        return val;
    }

    function calculateTotalBudget(){
        var data = getData();
        var result = data.quantity * data.budgetPerUnit;
        $('#totalBudget').val(zeroSeparator(result));
        $('#budgetPerUnit2').val(zeroSeparator(data.budgetPerUnit));

        calculateManagementCost();

        for (var i=0 ; i<othersIndex ; i++){
            otherPrice = document.getElementById('otherPrice-'+(i+1)).value;
            calculateOtherPercentage(i+1, otherPrice);
        }
    }

    function calculateManagementCost(){
        var data = getData();
        var result = data.budgetPerUnit*data.managementCostPercentage/100;
        $('#managementCost').val(zeroSeparator(result));

        calculateCostExcludeOperation();
    }

    function calculateCostExcludeOperation(){
        var data = getData();
        var result = data.managementCost+data.totalMaterialCost+data.totalOutsourceCost;
        for (var i=0; i<othersIndex; i++){
            result += parseFloat(document.getElementById(`otherPrice-${i+1}`).value);
        }

        $('#costExcludeOperation').val(zeroSeparator(result));

        var operationBudget = data.budgetPerUnit - result;
        $('#operationBudget').val(zeroSeparator(operationBudget));
        if (operationBudget < 0) {
            document.getElementById("operationBudget").style.color = "white";
            document.getElementById("operationBudget").style.backgroundColor = "red";
        } else {
            document.getElementById("operationBudget").style.color = "black";
            document.getElementById("operationBudget").style.backgroundColor = "transparent";
        }
    }

    function calculateTotalMaterialCost(){
        var data = getData();
        var result = data.materialCost * data.materialCostPercentage/100;
        $('#totalMaterialCost').val(zeroSeparator(result));

        calculateCostExcludeOperation();
    }

    function calculateTotalOursourceCost(){
        var data = getData();
        var result = data.outsourceCost * data.outsourceCostPercentage / 100;
        $('#totalOutsourceCost').val(zeroSeparator(result));

        calculateCostExcludeOperation();
    }

    
</script>

<!-- material function -->
<script>
    function getMaterialData(materialIndex){
        var data = {
            'usedQuantity' : isNaN(parseInt(document.getElementById(`usedQuantity-${materialIndex}`).value)) ? 0 : parseInt(document.getElementById(`usedQuantity-${materialIndex}`).value),
            'materialNumber' : isNaN(parseInt(document.getElementById(`materialNumber-${materialIndex}`).value)) ? 0 : parseInt(document.getElementById(`materialNumber-${materialIndex}`).value),
            'materialCost' : isNaN(parseInt(document.getElementById(`materialCost-${materialIndex}`).value)) ? 0 : parseInt(document.getElementById(`materialCost-${materialIndex}`).value),
        }

        return data;
    }

    function setMaterialData(materialIndex, usedQuantity, materialNumber, materialCost){
        $(`#usedQuantity-${materialIndex}`).val(usedQuantity);
        $(`#materialNumber-${materialIndex}`).val(materialNumber);
        $(`#materialCost-${materialIndex}`).val(materialCost);
    }

    function addMaterial() {
        // get material name from search input 
        var materialName = document.getElementById('searchName').value;

        // get material database from py file 
        var material = '{{materialjs|safe}}';
        const obj = JSON.parse(material);
        var selectedMaterial = obj.find(element => element.Name == materialName);

        if(selectedMaterial == undefined){
            return false;
        }
        
        // check for duplicate material
        if(Object.entries(materialList).length != 0){
            var checkName = materialList.find(element => element.Name == materialName);
            if (checkName == undefined){
                materialList.push(selectedMaterial);
            } else {
                if (checkName.idMaterial == selectedMaterial.idMaterial){
                    return false;
                }
                materialList.push(selectedMaterial);
            }
        } else {
            materialList.push(selectedMaterial);
        }
        
        // alter table to add process 
        var table = document.getElementById("materialTable").getElementsByTagName('tbody')[0];
        materialIndex++;

        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        var cell8 = row.insertCell(7);
        var cell9 = row.insertCell(8);
        var cell10 = row.insertCell(9);

        // <tr>
        //   <th scope="row">1</th>
        //   <td><input type="input" class="inputt " ></td>
        //   <td><input type="input"></td>
        //   <td><input type="input" class="inputt1 "></td>
        //   <td><input type="input" class="inputt1 "><a data-bs-toggle="modal" data-bs-target="#exampleModal1"><img class="imgcalcu" src="{% static 'images/calculator.png' %}"></a></td>
        //   <td>0</td>
        //   <td>10500</td>
        //   <td><input type="input" class="inputt1 "></td>
        //   <td><button type="button" class="trash"><i data-feather="trash-2"></i></button></td>
        // </tr>

        cell1.innerHTML = `<th scope="row">${materialIndex}</th>`;
        cell2.innerHTML = `<td><input type="input" class="inputt">${selectedMaterial.idMaterial}</td>`;
        cell3.innerHTML = `<td><input type="input">${selectedMaterial.Name}</td>`;
        cell4.innerHTML = `<td><input type="input" list="process" class="inputt1"></td>`;
        cell5.innerHTML = `<td><input type="input" class="inputt1" onchange="calculateByUsedQuantity(${materialIndex})" name="usedQuantity-${materialIndex}" id="usedQuantity-${materialIndex}"><a data-bs-toggle="modal" data-bs-target="#exampleModal1"><img class="imgcalcu" src="{% static 'images/calculator.png' %}"></a></td>`;
        cell6.innerHTML = `<td><input type="input" class="inputt1" onchange="calculateByNumber(${materialIndex})" name="materialNumber-${materialIndex}" id="materialNumber-${materialIndex}">0</td>`;
        cell7.innerHTML = `<td>${selectedMaterial.Price}</td>`;
        cell8.innerHTML = `<td><input type="input" class="inputt1 name="materialCost-${materialIndex}" id=materialCost-${materialIndex}></td>`;
        cell9.innerHTML = `<td><button type="button" onclick="deleteMaterial(${materialIndex})" class="trash"><i data-feather="trash-2"></i></button></td>`;
        cell10.innerHTML = `<td><input type="hidden" name='idMaterial-${materialIndex}' value='${selectedMaterial.idMaterial}'></td>`;

        callFeatherIcon();
        updateMaterialLength(index);

        return false;
    }

    function updateMaterialLength(index){
        $('#materialLength').val(index);
    }

    function deleteMaterial(rowindex){
        // console.log(index);
        var table = document.getElementById("materialTable").getElementsByTagName('tbody')[0];
        table.deleteRow(rowindex-1);

        // remove item from array and fixing the index 
        materialList.splice(rowindex-1, 4);
        materialIndex-=1;
        for(var i=0 ; i<materialIndex ; i++){
            table.rows[i].cells[0].innerHTML = `<th scope="row">${i+1}</th>`;
            table.rows[i].cells[8].innerHTML = `<td><button type="button" onclick="deleteMaterial(${i+1})" class="trash"><i id="trash-icon"></i></button></td>`;
            callFeatherIcon();
        }

        updateMaterialLength(index);
    }

    function calculateMaterialCost(usedQuantity, price){
        var result = usedQuantity * price;
        return result;
    }

    function calculateUsedQuantity(number){
        var result = 1/number;
        return result;
    }

    function calculateByUsedQuantity(materialIndex){
        var materialData = getMaterialData(materialIndex);
        var data = getMaterialData();
        var material = materialList[materialIndex-1];

        var materialCost = calculateMaterialCost(data.usedQuantity, material.Price);
        $(`#materialCost-${materialIndex}`).val(materialCost);
    }

    function calculateByNumber(number){
        var materialData = getMaterialData(materialIndex);
        var data = getMaterialData();
        var material = materialList[materialIndex-1];

        var usedQuantity = calculateUsedQuantity(data.materialNumber);
        var materialCost = calculateMaterialCost(usedQuantity, material.Price);
        
        setMaterialData(materialIndex, usedQuantity, data.materialNumber, materialCost);
    }

</script>

<!-- process function -->
<script>
    function addProcess() {
        // get process name from search input 
        var processName = document.getElementById('processName').value;

        // get process database from py file 
        var process = '{{processjs|safe}}';
        const obj = JSON.parse(process);
        var selectedProcess = obj.find(element => element.Name == processName);

        if(selectedProcess == undefined){
            return false;
        }
        
        // check for duplicate process
        if(Object.entries(processList).length != 0){
            var checkName = processList.find(element => element.Name == processName);
            if (checkName == undefined){
                processList.push(selectedProcess);
            } else {
                if (checkName.ProcessId == selectedProcess.ProcessId){
                    return false;
                }
                processList.push(selectedProcess);
            }
        } else {
            processList.push(selectedProcess);
        }
        
        // alter table to add process 
        var table = document.getElementById("processTable").getElementsByTagName('tbody')[0];
        index++;

        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        var cell8 = row.insertCell(7);
        var cell9 = row.insertCell(8);
        var cell10 = row.insertCell(9);
        var cell11 = row.insertCell(10);
        var cell12 = row.insertCell(11);
        var cell13 = row.insertCell(12);

        cell1.innerHTML = `<th scope="row">${index}</th>`;
        cell2.innerHTML = `<td>${selectedProcess.ProcessId}</td>`;
        cell3.innerHTML = `<td>${selectedProcess.Name}</td>`;
        cell4.innerHTML = `<td>${selectedProcess.SettingCost}/${selectedProcess.ProcessCost}</td>`;
        cell5.innerHTML = `<td><input type="text" class="operationInputMd" onchange="calculateByOpeSum(${index})" name='opeSum-${index}' id='opeSum-${index}'></td>`;
        cell6.innerHTML = `<td><input type="text" class="inputS" name='operationPerOperationBudgetRatio-${index}' onchange="calculateByOperationPerOperationBudgetRatio(${index})" id='operationPerOperationBudgetRatio-${index}'> %</td>`;
        cell7.innerHTML = `<td><input type="text" class="inputS" name='operationPerBudgetRatio-${index}' onchange="calculateByOperationPerBudgetRatio(${index})" id='operationPerBudgetRatio-${index}'> %</td>`;
        cell8.innerHTML = `<td><input type="text" value="00:00:00" onchange="calculateBySetTime(${index})" class="operationInputMd" name='setTime-${index}' id='setTime-${index}'></td>`;
        cell9.innerHTML = `<td><input type="text" value="00:00:00" class="operationInputMd" name='opeTime-${index}' id='opeTime-${index}'></td>`;
        cell10.innerHTML = `<td><input type="text" value="00:00:00" class="operationInputMd" 
            onchange="calculateTotalOpeTime(${index})" name='totalOpeTime-${index}' id='totalOpeTime-${index}'></td>`;
        cell11.innerHTML = `<td><input type="text" class="inputS" name='quantityPerMinute-${index}' id='quantityPerMinute-${index}'></td>`;
        cell12.innerHTML = `<td><button type="button" onclick="deleteProcess(${index})" class="trash"><i id="trash-icon"></i></button></td>`;
        cell13.innerHTML = `<td><input type="hidden" name='processId-${index}' value='${index}'></td>`;

        callFeatherIcon();
        updateProcessLength(index);

        return false;
    }

    function updateProcessLength(index){
        $('#processLength').val(index);
    }

    function deleteProcess(rowindex){
        // console.log(index);
        var table = document.getElementById("processTable").getElementsByTagName('tbody')[0];
        table.deleteRow(rowindex-1);

        // remove item from array and fixing the index 
        processList.splice(rowindex-1, 4);
        index-=1;
        for(var i=0 ; i<index ; i++){
            table.rows[i].cells[0].innerHTML = `<th scope="row">${i+1}</th>`;
            table.rows[i].cells[11].innerHTML = `<td><button type="button" onclick="deleteProcess(${i+1})" class="trash"><i id="trash-icon"></i></button></td>`;
            callFeatherIcon();
        }

        updateProcessLength(index);
    }

    function callFeatherIcon(){
        const trashicon = $('#trash-icon');
        trashicon.replaceWith(feather.icons['trash-2'].toSvg());
    }

    function getProcessData(index){
        var data = {
            'opeSum' : isNaN(parseInt(document.getElementById(`opeSum-${index}`).value)) ? 0 : parseInt(document.getElementById(`opeSum-${index}`).value),
            'operationPerOperationBudgetRatio' : isNaN(parseFloat(document.getElementById(`operationPerOperationBudgetRatio-${index}`).value)) ? 0 : parseFloat(document.getElementById(`operationPerOperationBudgetRatio-${index}`).value),
            'operationPerBudgetRatio' : isNaN(parseFloat(document.getElementById(`operationPerBudgetRatio-${index}`).value)) ? 0 : parseFloat(document.getElementById(`operationPerBudgetRatio-${index}`).value),
            'setTime' : document.getElementById(`setTime-${index}`).value == '' ? "00:00:00" : document.getElementById(`setTime-${index}`).value,
            'opeTime' : document.getElementById(`opeTime-${index}`).value == '' ? "00:00:00" : document.getElementById(`opeTime-${index}`).value,
            'totalOpeTime' : (document.getElementById(`totalOpeTime-${index}`).value) ? "00:00:00" : document.getElementById(`totalOpeTime-${index}`).value,
            'quantityPerMinute' : isNaN(parseFloat(document.getElementById(`quantityPerMinute-${index}`).value)) ? 0 : parseFloat(document.getElementById(`quantityPerMinute-${index}`).value),
        }

        return data;
    }

    function setProcessData(index, opeSum, operationPerOperationBudgetRatio, operationPerBudgetRatio, setTime, opeTime, totalOpeTime, quantityPerMinute){
        $(`#opeSum-${index}`).val(opeSum);
        $(`#operationPerOperationBudgetRatio-${index}`).val(operationPerOperationBudgetRatio);
        $(`#operationPerBudgetRatio-${index}`).val(operationPerBudgetRatio);
        $(`#setTime-${index}`).val(setTime);
        $(`#opeTime-${index}`).val(opeTime);
        $(`#totalOpeTime-${index}`).val(totalOpeTime);
        $(`#quantityPerMinute-${index}`).val(quantityPerMinute);
    }

    function calculateOperationPerOperationBudgetRatio(opeSum, operationBudget) {
        var result = opeSum / operationBudget * 100;
        var resultFixed = result.toFixed(2);
        return resultFixed;
    }

    function calculateOpePerBudgetRatio(opeSum, budgetPerUnit) {
        var result = opeSum / budgetPerUnit * 100;
        var resultFixed = result.toFixed(2);
        return resultFixed;
    }

    function calculateOpeTime(opeSum, procCost) {
        var result = opeSum / parseFloat(procCost) * 60;
        // setTime = setTime.split(':');
        // setTime = (+setTime[0]) * 60 * 60 + (+setTime[1]) * 60 + (+setTime[2]);  //convert date time to second
        // if(setTime != '' && setTime != 0 && setTime != '00:00:00'){
        //     var result = (opeSum - ((setTime * setCost)/60)*60)/procCost;
        // } else {
        //     var result = opeSum / parseFloat(procCost) * 60;
        //     // if((setTime*setCost)/60 > opeSum ){
        //     // }
        // }
        var resultFixed = new Date(result * 1000).toISOString().slice(11, 19);
        return resultFixed;
    }

    function calculateTotalOpeTime(opeTime, quantity) {
        opeTime = opeTime.split(':');
        opeTime = (+opeTime[0]) * 60 * 60 + (+opeTime[1]) * 60 + (+opeTime[2]); //convert date time to second
        var result = opeTime * quantity;
        var resultFixed = new Date(result * 1000).toISOString().slice(11, 19); //convert second to datetime
        return resultFixed;
    }

    function calculateQuantityPerMinute(opeTime) {
        opeTime = opeTime.split(':');
        opeTime = (+opeTime[0]) * 60 * 60 + (+opeTime[1]) * 60 + (+opeTime[2]); //convert date time to second
        var result = 60 / opeTime;
        return result.toFixed(2);
    }

    function calculateBySetTime(index){
        var processData = getProcessData(index);
        var data = getData();
        var process = processList[index-1];

        if(processData.opeSum == '' && processData.opeSum == 0 ){
            processData.setTime = processData.setTime.split(':');
            processData.setTime = (+processData.setTime[0]) * 60 * 60 + (+processData.setTime[1]) * 60 + (+processData.setTime[2]); 
            var opeSum = ((processData.setTime*process.SettingCost)/60);
            $(`#opeSum-${index}`).val(opeSum);
            calculateByOpeSum(index);
        } else {
            
            
        }

    }

    function calculateByOpeSum(index){
        var processData = getProcessData(index);
        var data = getData();
        var process = processList[index-1];

        if (processData.setTime != '' && processData.setTime != '00:00:00'){
            if (processData.opeTime == '' || processData.opeTime == '00:00:00'){
                var operationPerOperationBudgetRatio = calculateOperationPerOperationBudgetRatio(processData.opeSum, data.operationBudget);
                var operationPerBudgetRatio = calculateOpePerBudgetRatio(processData.opeSum, data.budgetPerUnit);
                var opeTime = '00:00:00';
                var totalOpeTime = '00:00:00';
                var quantityPerMinute = 0;
            } else {
                var opeSum = processData.opeSum - ((processData.setTime*process.setCost)/60);
                var operationPerOperationBudgetRatio = calculateOperationPerOperationBudgetRatio(processData.opeSum, data.operationBudget);
                var operationPerBudgetRatio = calculateOpePerBudgetRatio(processData.opeSum, data.budgetPerUnit);
                var opeTime = calculateOpeTime(opeSum, process.ProcessCost);
                var totalOpeTime = calculateTotalOpeTime(opeTime, data.quantity);
                var quantityPerMinute = calculateQuantityPerMinute(opeTime);

                // ope sum - calculate ope sum by settime
                // lalu hasilnya baru dipake buat ngitung opetime
                // ambil data opesum sekarang yang sudah diubah oleh settime += calculate opesum by ope time
            }
        } else {
            var operationPerOperationBudgetRatio = calculateOperationPerOperationBudgetRatio(processData.opeSum, data.operationBudget);
            var operationPerBudgetRatio = calculateOpePerBudgetRatio(processData.opeSum, data.budgetPerUnit);
            var opeTime = calculateOpeTime(processData.opeSum, process.ProcessCost);
            var totalOpeTime = calculateTotalOpeTime(opeTime, data.quantity);
            var quantityPerMinute = calculateQuantityPerMinute(opeTime);
        }
        setProcessData(index, processData.opeSum, operationPerOperationBudgetRatio, operationPerBudgetRatio, processData.setTime, opeTime, totalOpeTime, quantityPerMinute);
    }

    function calculateByOperationPerOperationBudgetRatio(index){
        var processData = getProcessData(index);
        var data = getData();

        var opeSum = Math.round(processData.operationPerOperationBudgetRatio * data.operationBudget / 100);
        $(`#opeSum-${index}`).val(opeSum);

        calculateByOpeSum(index);
    }

    function calculateByOperationPerBudgetRatio(index){
        var processData = getProcessData(index);
        var data = getData();

        var opeSum = Math.round(processData.operationPerBudgetRatio * data.budgetPerUnit / 100);
        $(`#opeSum-${index}`).val(opeSum);

        calculateByOpeSum(index);
    }

    function calculateByOpeTime(index){
        var processData = getProcessData(index);
        var data = getData();

        // var opeSum = data.opeTime
        // var opeSum = Math.round(processData.operationPerBudgetRatio * data.budgetPerUnit / 100);
        $(`#opeSum-${index}`).val(opeSum);

        calculateByOpeSum(index);
    }
    

</script>

<!-- others function  -->
<script>
    function addOther() {
        // get others name from search input 
        var otherName = document.getElementById('otherName').value;

        // get others database from py file 
        var others = '{{othersjs|safe}}';
        const obj = JSON.parse(others);
        var selectedOthers = obj.find(element => element.Name == otherName);

        if(selectedOthers == undefined){
            return false;
        }
        
        // check for duplicate others
        if(Object.entries(othersList).length != 0){
            var checkName = othersList.find(element => element.Name == otherName);
            if (checkName == undefined){
                othersList.push(selectedOthers);
            } else {
                if (checkName.ProcessId == selectedOthers.OtherId){
                    return false;
                }
                othersList.push(selectedOthers);
            }
        } else {
            othersList.push(selectedOthers);
        }
        
        // alter table to add others 
        var table = document.getElementById("othersTable").getElementsByTagName('tbody')[0];
        othersIndex++;

        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);

        cell1.innerHTML = `<th scope="row">${othersIndex}</th>`;
        cell2.innerHTML = `<td>${selectedOthers.Name}</td>`;
        cell3.innerHTML = `<td><input type="input" id="otherPrice-${othersIndex}" onchange="calculateOtherPercentage(${othersIndex}, this.value)" class="inputMd"></td>`;
        cell4.innerHTML = `<td><input type="input" class="inputPercentage" id="otherPercentage-${othersIndex}"></td>`;
        cell5.innerHTML = `<td><input type="checkbox"></td>`;
        cell6.innerHTML = `<td><button type="button" onclick="deleteOther(${othersIndex})" class="trash"><i id="trash-icon"></i></button></td>`;
        cell7.innerHTML = `<td><input type="hidden" name='othersId-${othersIndex}' value='${selectedOthers.OtherId}'></td>`;
        
        callFeatherIcon();
        updateOtherLength(othersIndex);

        return false;
    }

    function deleteOther(rowindex){
        var table = document.getElementById("othersTable").getElementsByTagName('tbody')[0];
        table.deleteRow(rowindex-1);

        // remove item from array and fixing the index 
        othersList.splice(rowindex-1, 2);
        othersIndex-=1;
        for(var i=0 ; i<othersIndex ; i++){
            table.rows[i].cells[0].innerHTML = `<th scope="row">${i+1}</th>`;
            table.rows[i].cells[5].innerHTML = `<td><button type="button" onclick="deleteOther(${i+1})" class="trash"><i id="trash-icon"></i></button></td>`;
            callFeatherIcon();
        }

        updateOtherLength(othersIndex);
    }

    function updateOtherLength(index){
        $('#othersLength').val(index);
    }

    function calculateOtherPercentage(index, val){
        var data = getData();
        var percent = parseFloat(val)/data.budgetPerUnit*100;
        $('#otherPercentage-'+index).val(percent);

        calculateCostExcludeOperation();
    }
</script>

{% endblock scripts %}